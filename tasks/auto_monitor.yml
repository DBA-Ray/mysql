- name: Create a directory for monitor
  file: >
        path={{ monitordir }} state=directory owner=mysql group=mysql
        path={{ shelldir }} state=directory owner=mysql group=mysql

- name: Rendering monitor script file
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: mysql
    group: mysql
    mode: 0744
  with_items:
    - { src: 'alert_mgr_status.sh.j2', dest: '{{ shelldir }}/alert_mgr_status.sh' }
    - { src: 'alert_slave_status.sh.j2', dest: '{{ shelldir }}"/alert_slave_status.sh' }

- name: Add automatic monitor mgr&slave schedule for slave_monitor1
  cron:
    name: "automatic monitor mgr&slave"
    minute: "*/2"
    hour: "*"
    job: "{{ item }}"
  with_items:
    - "{{ shelldir }}/alert_mgr_status.sh > /dev/null"
    - "{{ shelldir }}/alert_slave_status.sh > /dev/null"
  when: ansible_hostname == "slave_monitor1"

- name: Add automatic monitor mgr&slave schedule for slave_monitor2
  cron:
    name: "automatic monitor mgr&slave"
    minute: "*/3"
    hour: "*"
    job: "{{ item }}"
  with_items:
    - "{{ shelldir }}/alert_mgr_status.sh > /dev/null"
    - "{{ shelldir }}/alert_slave_status.sh > /dev/null"
  when: ansible_hostname == "slave_monitor2"

- name: Add automatic slave schedule for slave1
  cron:
    name: "automatic monitor slave"
    minute: "*/2"
    hour: "*"
    job: "{{ item }}"
  with_items:
    - "{{ shelldir }}/alert_slave_status.sh > /dev/null"
  when: ansible_hostname == "slave1"

- name: Add automatic slave schedule for slave2
  cron:
    name: "automatic monitor slave"
    minute: "*/3"
    hour: "*"
    job: "{{ item }}"
  with_items:
    - "{{ shelldir }}/alert_slave_status.sh > /dev/null"
  when: ansible_hostname == "slave2"
